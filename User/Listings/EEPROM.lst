C51 COMPILER V9.60.7.0   EEPROM                                                            11/29/2024 17:30:56 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE EEPROM
OBJECT MODULE PLACED IN .\Objects\EEPROM.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Hardware\EEPROM.C OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Hardware) DEBUG 
                    -OBJECTEXTEND PRINT(.\Listings\EEPROM.lst) TABS(2) OBJECT(.\Objects\EEPROM.obj)

line level    source

   1          #include "EEPROM.h"
   2          #include "intrins.h"
   3          
   4          
   5          /*注意，该程序仅用于STC12C5A60S2系列单片机，如果用于其他系列单片机，请确认是否需要修改EEPROM，
   6          因为STC单片机的不同系列，内部EEPROM地址不同，例如STC89C51RC系列单片机内部EEPROM起始地址为2000h,
   7          而STC12C5A60S2内部EEPROM起始地址为0000h,且STC89C51RC系列单片机和STC12C5A60S2系列单片机内部与
   8          EEPROM有关的寄存器地址是不同的，具体参考STC89C51RC和STC12C5A60S2系列单片机手册*/
   9          
  10          sfr IAP_DATA  =0xc2;
  11          sfr IAP_ADDRH =0xc3;
  12          sfr IAP_ADDRL =0xc4;
  13          sfr IAP_CMD   =0xc5;
  14          sfr IAP_TRIG  =0xc6;
  15          sfr IAP_CONTR =0xc7;
  16          
  17          
  18          
  19          
  20          /******************************************************************
  21           - 函数名称：IAP_Idle
  22           - 功能描述：关闭IAP读/写/擦除Data Flash/EEPROM功能
  23           - 函数属性：外部函数，供用户调用
  24           - 参数说明：无
  25           - 返回说明：无
  26           - 注    ：无
  27           ******************************************************************/
  28          void IAP_Idle(void)
  29          {
  30   1        IAP_CONTR=0;
  31   1        IAP_CMD=0;
  32   1        IAP_TRIG=0;
  33   1        IAP_ADDRH=0x80;
  34   1        IAP_ADDRL=0;
  35   1        
  36   1      } 
  37          
  38          /******************************************************************
  39           - 函数名称：IAP_ReadByte
  40           - 功能描述：读取内部EEPROM地址addr的数据
  41           - 函数属性：外部函数，供用户调用
  42           - 参数说明：addr-->内部地址
  43           - 返回说明：无
  44           - 注    ：无
  45           ******************************************************************/
  46          unsigned char IAP_ReadByte(unsigned int addr)
  47          {
  48   1        unsigned dat;
  49   1        
  50   1        IAP_CONTR=ENABLE_IAP;
  51   1        IAP_CMD=CMD_READ;
  52   1        IAP_ADDRL=addr;
  53   1        IAP_ADDRH=addr>>8;
  54   1        IAP_TRIG=0x5a;
C51 COMPILER V9.60.7.0   EEPROM                                                            11/29/2024 17:30:56 PAGE 2   

  55   1        IAP_TRIG=0xa5;
  56   1        _nop_();
  57   1        
  58   1        dat=IAP_DATA;
  59   1        IAP_Idle();
  60   1        
  61   1        return dat;
  62   1      }
  63          
  64          /******************************************************************
  65           - 函数名称：IAP_ProgramByte
  66           - 功能描述：写内部EEPROM地址addr的数据
  67           - 函数属性：外部函数，供用户调用
  68           - 参数说明：addr-->内部地址
  69                 dat-->需要写入的数据
  70           - 返回说明：无
  71           - 注    ：无
  72           ******************************************************************/
  73          void IAP_ProgramByte(unsigned int addr,unsigned char dat)
  74          {
  75   1        IAP_CONTR=ENABLE_IAP;
  76   1        IAP_CMD=CMD_PROGRAM;
  77   1        IAP_ADDRL=addr;
  78   1        IAP_ADDRH=addr>>8;
  79   1        IAP_DATA=dat;
  80   1        IAP_TRIG=0x5a;
  81   1        IAP_TRIG=0xa5;
  82   1        _nop_();
  83   1        
  84   1        IAP_Idle();
  85   1      }
  86          
  87          /******************************************************************
  88           - 函数名称：IAP_EraseSector
  89           - 功能描述：擦除内部EEPROM的扇区数据
  90           - 函数属性：外部函数，供用户调用
  91           - 参数说明：addr-->内部地址
  92           - 返回说明：无
  93           - 注    ：1.只有“扇区擦除”才能将“0”擦除为“1”
  94           ******************************************************************/
  95          void IAP_EraseSector(unsigned int addr)
  96          {
  97   1        IAP_CONTR=ENABLE_IAP;
  98   1        IAP_CMD=CMD_ERASE;
  99   1        IAP_ADDRL=addr;
 100   1        IAP_ADDRH=addr>>8;
 101   1        IAP_TRIG=0x5a;
 102   1        IAP_TRIG=0xa5;
 103   1        _nop_();
 104   1        
 105   1        IAP_Idle();
 106   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     79    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.60.7.0   EEPROM                                                            11/29/2024 17:30:56 PAGE 3   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
