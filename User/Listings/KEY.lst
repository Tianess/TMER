C51 COMPILER V9.60.7.0   KEY                                                               11/29/2024 17:30:57 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\KEY.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Hardware\KEY.C OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Hardware) DEBUG OBJ
                    -ECTEXTEND PRINT(.\Listings\KEY.lst) TABS(2) OBJECT(.\Objects\KEY.obj)

line level    source

   1          #include <STC12C5A60S2.H>
   2          #include "KEY.H"
   3          #include "main.h"
   4          
   5          unsigned char Key(void)
   6          {
   7   1        unsigned char Temp;           //中间变量Temp，便于赋值一次消零
   8   1        Temp=Key_KeyNumber;
   9   1        Key_KeyNumber=0;
  10   1        return Temp;
  11   1      }
  12          
  13          unsigned char KeyData(void)           //读取动态按键变化
  14          {
  15   1        unsigned char KeyNumber=0;
  16   1        
  17   1        if(KEY1==0){KeyNumber=11;}
  18   1        if(KEY2==0){KeyNumber=21;}
  19   1        if(KEY3==0){KeyNumber=31;}
  20   1        
  21   1        return KeyNumber;       //返回按键的值
  22   1      }
  23          
  24          void Loop_Key(void)
  25          {
  26   1        LastKey=NowKey;             //LastKey：上一次的按键值
  27   1        NowKey=KeyData();           //NowKey：当前的按键值
  28   1      
  29   1        if(LastKey)               //当按键按下时开始计时
  30   1        { KeyNumber=LastKey;
  31   2          KeyTime++;
  32   2          if(KeyTime<25 && NowKey==0)     //如果按键的时间小于250ms
  33   2          { 
  34   3            KeyTime=0;
  35   3            OnceKey++;            //OnceKey每松手一次加1
  36   3          }
  37   2          else if(KeyTime>=25 && NowKey)    //如果按键时间大于250ms且现按键还在按下
  38   2          {
  39   3            
  40   3            if(LastKey==11){Key_KeyNumber=13;}  //给按键赋值
  41   3            if(LastKey==21){Key_KeyNumber=23;}
  42   3            if(LastKey==31){Key_KeyNumber=33;}
  43   3            
  44   3          }
  45   2          if(NowKey==0 && LastKey && KeyTime>=25)//防止长按后立即被当成短按再次赋值
  46   2          {
  47   3            Key_KeyNumber=0;KeyTime=0;
  48   3          }
  49   2      
  50   2        }
  51   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V9.60.7.0   KEY                                                               11/29/2024 17:30:57 PAGE 2   

   CODE SIZE        =    113    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
