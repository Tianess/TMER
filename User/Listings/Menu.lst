C51 COMPILER V9.60.7.0   MENU                                                              11/29/2024 17:30:57 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MENU
OBJECT MODULE PLACED IN .\Objects\Menu.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Hardware\Menu.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Hardware) DEBUG OB
                    -JECTEXTEND PRINT(.\Listings\Menu.lst) TABS(2) OBJECT(.\Objects\Menu.obj)

line level    source

   1          #include <STC12C5A60S2.H>
   2          #include "main.h"
   3          #include "MENU.H"
   4          #include "OLED.H"
   5          #include "DS1302.H"
   6          #include "UART1.H"
   7          #include "UART2.H"
   8          #include "EEPROM.H"
   9          
  10          void Menu(u8 KeyNum)
  11          {
  12   1        //显示按键
  13   1        if(KeyNum == Key1_Single_Click) {OLED_ShowString(0,6,"K1S",8,1);}
  14   1        if(KeyNum == Key1_Double_Click) {OLED_ShowString(0,6,"K1D",8,1);}
  15   1        if(KeyNum == Key1_Long_Click)   {OLED_ShowString(0,6,"K1L",8,1);}
  16   1        
  17   1        if(KeyNum == Key2_Single_Click) {OLED_ShowString(0,6,"K2S",8,1);}
  18   1        if(KeyNum == Key2_Double_Click) {OLED_ShowString(0,6,"K2D",8,1);}
  19   1        if(KeyNum == Key2_Long_Click)   {OLED_ShowString(0,6,"K2L",8,1);}
  20   1                                      
  21   1        if(KeyNum == Key3_Single_Click) {OLED_ShowString(0,6,"K3S",8,1);}
  22   1        if(KeyNum == Key3_Double_Click) {OLED_ShowString(0,6,"K3D",8,1);}
  23   1        if(KeyNum == Key3_Long_Click)   {OLED_ShowString(0,6,"K3L",8,1);}
  24   1            
  25   1        if(Menu_state==10||Menu_state==12||Menu_state==14)//一级菜单处理
  26   1        {
  27   2          if(KeyNum==Key1_Single_Click)//按键1按下光标下移
  28   2          {
  29   3            Menu_state=Menu_state-2;
  30   3            if(Menu_state<10){Menu_state=14;}
  31   3            OLED_Background1(Menu_state);
  32   3          }
  33   2          if(KeyNum==Key2_Single_Click)//按键2按下光标上移
  34   2          {
  35   3            
  36   3            Menu_state=Menu_state+2;
  37   3            if(Menu_state>14){Menu_state=10;}
  38   3            OLED_Background1(Menu_state);
  39   3          }
  40   2          if(KeyNum==Key3_Single_Click)//按键3按下进入
  41   2          {
  42   3            Menu_state+=10;
  43   3            KeyNum=0;
  44   3            OLED_Clear();
  45   3          }
  46   2        }
  47   1        if(Menu_state==20||Menu_state==22||Menu_state==24)//二级菜单处理
  48   1        {
  49   2          Secondary_Menu(Menu_state,KeyNum);
  50   2          if(Menu_state==20)
  51   2          {
  52   3            if(KeyNum==Key1_Single_Click){Stopwatchflag=1;}//秒表启动
  53   3            if(KeyNum==Key2_Single_Click){Stopwatchflag=0;}//秒表暂停
  54   3            if(KeyNum==Key2_Long_Click){Msec=0;Sec=0;Min=0;}//时间清除
C51 COMPILER V9.60.7.0   MENU                                                              11/29/2024 17:30:57 PAGE 2   

  55   3          }
  56   2          else if(Menu_state==22)
  57   2          {
  58   3            if(Countdownflag!=1)//倒计时时间选择位
  59   3            {       
  60   4              if(KeyNum==Key3_Single_Click)
  61   4              {
  62   5                Countdown_select++;
  63   5                Countdown_select%=3;
  64   5              }
  65   4              
  66   4              switch(Countdown_select)
  67   4              {//倒计时时间增减
  68   5                case 0://小时增减
  69   5                      if(KeyNum==Key1_Long_Click||KeyNum==Key1_Single_Click){Countdown_Hour++;if(Countdown_Hour>60){Coun
             -tdown_Hour=0;}}
  70   5                      if(KeyNum==Key2_Long_Click||KeyNum==Key2_Single_Click){Countdown_Hour--;if(Countdown_Hour<0){Count
             -down_Hour=60;}}
  71   5                      if(Countdown_Hour<10){OLED_ShowString(16,02,"0",16,0);OLED_ShowNum(24,02,Countdown_Hour,1,16,0);}
  72   5                      else{OLED_ShowNum(16,02,Countdown_Hour,2,16,0);}
  73   5                      if(Countdown_Min<10){OLED_ShowString(48,02,"0",16,1);OLED_ShowNum(56,02,Countdown_Min,1,16,1);}
  74   5                      else{OLED_ShowNum(48,02,Countdown_Min,2,16,1);}
  75   5                      if(Countdown_Sec<10){OLED_ShowString(80,02,"0",16,1);OLED_ShowNum(88,02,Countdown_Sec,1,16,1);}
  76   5                      else{OLED_ShowNum(80,02,Countdown_Sec,2,16,1);}
  77   5                      break;
  78   5                case 1://分钟增减
  79   5                      if(KeyNum==Key1_Long_Click||KeyNum==Key1_Single_Click){Countdown_Min++;if(Countdown_Min>=60){Count
             -down_Min=0;}}
  80   5                      if(KeyNum==Key2_Long_Click||KeyNum==Key2_Single_Click){Countdown_Min--;if(Countdown_Min<0){Countdo
             -wn_Min=59;}}
  81   5                      if(Countdown_Hour<10){OLED_ShowString(16,02,"0",16,1);OLED_ShowNum(24,02,Countdown_Hour,1,16,1);}
  82   5                      else{OLED_ShowNum(16,02,Countdown_Hour,2,16,1);}
  83   5                      if(Countdown_Min<10){OLED_ShowString(48,02,"0",16,0);OLED_ShowNum(56,02,Countdown_Min,1,16,0);}
  84   5                      else{OLED_ShowNum(48,02,Countdown_Min,2,16,0);}
  85   5                      if(Countdown_Sec<10){OLED_ShowString(80,02,"0",16,1);OLED_ShowNum(88,02,Countdown_Sec,1,16,1);}
  86   5                      else{OLED_ShowNum(80,02,Countdown_Sec,2,16,1);}
  87   5                      break;
  88   5                case 2://秒数增减
  89   5                      if(KeyNum==Key1_Long_Click||KeyNum==Key1_Single_Click){Countdown_Sec++;if(Countdown_Sec>=60){Count
             -down_Sec=0;}}
  90   5                      if(KeyNum==Key2_Long_Click||KeyNum==Key2_Single_Click){Countdown_Sec--;if(Countdown_Sec<0){Countdo
             -wn_Sec=59;}}
  91   5                      if(Countdown_Hour<10){OLED_ShowString(16,02,"0",16,1);OLED_ShowNum(24,02,Countdown_Hour,1,16,1);}
  92   5                      else{OLED_ShowNum(16,02,Countdown_Hour,2,16,1);}
  93   5                      if(Countdown_Min<10){OLED_ShowString(48,02,"0",16,1);OLED_ShowNum(56,02,Countdown_Min,1,16,1);}
  94   5                      else{OLED_ShowNum(48,02,Countdown_Min,2,16,1);}
  95   5                      if(Countdown_Sec<10){OLED_ShowString(80,02,"0",16,0);OLED_ShowNum(88,02,Countdown_Sec,1,16,0);}
  96   5                      else{OLED_ShowNum(80,02,Countdown_Sec,2,16,0);}
  97   5                      break;
  98   5              }
  99   4              if(KeyNum==Key3_Long_Click){Countdownflag=1;}//长按按键3启动
 100   4            }
 101   3            else
 102   3            {//启动倒计时后显示时间
 103   4              if(Countdown_Hour<10){OLED_ShowString(16,02,"0",16,1);OLED_ShowNum(24,02,Countdown_Hour,1,16,1);}
 104   4              else{OLED_ShowNum(16,02,Countdown_Hour,2,16,1);}
 105   4              if(Countdown_Min<10){OLED_ShowString(48,02,"0",16,1);OLED_ShowNum(56,02,Countdown_Min,1,16,1);}
 106   4              else{OLED_ShowNum(48,02,Countdown_Min,2,16,1);}
 107   4              if(Countdown_Sec<10){OLED_ShowString(80,02,"0",16,1);OLED_ShowNum(88,02,Countdown_Sec,1,16,1);}
 108   4              else{OLED_ShowNum(80,02,Countdown_Sec,2,16,1);}
 109   4              
 110   4            }
C51 COMPILER V9.60.7.0   MENU                                                              11/29/2024 17:30:57 PAGE 3   

 111   3            
 112   3              
 113   3          }
 114   2          else if(Menu_state==24)//设置界面
 115   2          {
 116   3            if(KeyNum==Key1_Single_Click||KeyNum==Key1_Long_Click)
 117   3            {
 118   4              if(--MenuSet_flag<0){MenuSet_flag=2;}
 119   4            }
 120   3            if(KeyNum==Key2_Single_Click||KeyNum==Key2_Long_Click)
 121   3            {
 122   4              if(++MenuSet_flag>2){MenuSet_flag=0;}
 123   4            }
 124   3            
 125   3            if(KeyNum==Key3_Single_Click)
 126   3            {
 127   4              if(MenuSet_flag==0){MenuSet_state=6;}//DS1302时间设置
 128   4              else if(MenuSet_flag==1){MenuSet_state=8;}//音量设置
 129   4              else if(MenuSet_flag==2){MenuSet_state=10;}//音量设置
 130   4              Menu_state+=MenuSet_state;
 131   4              KeyNum=0;
 132   4              OLED_Clear();
 133   4            }
 134   3          }
 135   2        }
 136   1        if(Menu_state==30||Menu_state==32||Menu_state==34)//三级菜单处理
 137   1        {
 138   2          if(Menu_state==30)
 139   2          { //设置DS1302时间
 140   3            TimeSetting=1;
 141   3            if(KeyNum==Key1_Single_Click||KeyNum==Key1_Long_Click)
 142   3            {
 143   4              DS1302_Time[TimeSelect]++;
 144   4              if(DS1302_Time[0]>99){DS1302_Time[0]=0;}//年+
 145   4              if(DS1302_Time[1]>12){DS1302_Time[1]=1;}//月+
 146   4              if(DS1302_Time[1]==1||DS1302_Time[1]==3||DS1302_Time[1]==5||DS1302_Time[1]==7||
 147   4                 DS1302_Time[1]==8||DS1302_Time[1]==10||DS1302_Time[1]==12)
 148   4              {//大月+
 149   5                if(DS1302_Time[2]>31){DS1302_Time[2]=1;}
 150   5              }
 151   4              else if(DS1302_Time[1]==4 || DS1302_Time[1]==6 || DS1302_Time[1]==9 || DS1302_Time[1]==11)
 152   4              {//小月+
 153   5                if(DS1302_Time[2]>30){DS1302_Time[2]=1;}
 154   5              }
 155   4              else if(DS1302_Time[1]==2)
 156   4              {//是否润年
 157   5                if(DS1302_Time[0]%4==0){if(DS1302_Time[2]>29){DS1302_Time[2]=1;}}
 158   5                else{if(DS1302_Time[2]>28){DS1302_Time[2]=1;}}
 159   5              }
 160   4              if(DS1302_Time[3]>23){DS1302_Time[3]=0;}//时
 161   4              if(DS1302_Time[4]>59){DS1302_Time[4]=0;}//分
 162   4              if(DS1302_Time[5]>59){DS1302_Time[5]=0;}//秒
 163   4            }
 164   3            else if(KeyNum==Key2_Single_Click||KeyNum==Key2_Long_Click)
 165   3            {
 166   4              DS1302_Time[TimeSelect]--;
 167   4              if(DS1302_Time[0]<0){DS1302_Time[0]=99;}//年
 168   4              if(DS1302_Time[1]<1){DS1302_Time[1]=12;}//月
 169   4              
 170   4              if(DS1302_Time[1]==1||DS1302_Time[1]==3||DS1302_Time[1]==5||DS1302_Time[1]==7|| 
 171   4                 DS1302_Time[1]==8||DS1302_Time[1]==10||DS1302_Time[1]==12)
 172   4              {//大月
C51 COMPILER V9.60.7.0   MENU                                                              11/29/2024 17:30:57 PAGE 4   

 173   5                if(DS1302_Time[2]<1){DS1302_Time[2]=31;}
 174   5              }
 175   4              else if(DS1302_Time[1]==4 || DS1302_Time[1]==6 || DS1302_Time[1]==9 || DS1302_Time[1]==11)
 176   4              {//小月
 177   5                if(DS1302_Time[2]<1){DS1302_Time[2]=30;}
 178   5              }
 179   4              else if(DS1302_Time[1]==2)//2月
 180   4              {//是否润年
 181   5                if(DS1302_Time[0]%4==0)
 182   5                {
 183   6                  if(DS1302_Time[2]<1){DS1302_Time[2]=29;}
 184   6                }
 185   5                else
 186   5                {
 187   6                  if(DS1302_Time[2]<1){DS1302_Time[2]=28;}
 188   6                }
 189   5              }
 190   4              if(DS1302_Time[3]<0){DS1302_Time[3]=23;}//时
 191   4              if(DS1302_Time[4]<0){DS1302_Time[4]=59;}//分
 192   4              if(DS1302_Time[5]<0){DS1302_Time[5]=59;}//秒
 193   4            }
 194   3            if(KeyNum==Key3_Single_Click){TimeSelect++;TimeSelect%=6;}
 195   3            if(KeyNum==Key3_Long_Click)
 196   3            {
 197   4              Menu_state-=MenuSet_state;
 198   4              if(TimeSetting==1){TimeSetting=0;DS1302_SetTime();}
 199   4              OLED_Clear();
 200   4              OLED_Background24();
 201   4            }
 202   3          }
 203   2          else if(Menu_state==32)
 204   2          {
 205   3            OLED_SetVolume();//设置音量
 206   3            if((KeyNum==Key1_Single_Click||KeyNum==Key1_Long_Click)&&Busy_Music==1)
 207   3            {
 208   4              Volume++;
 209   4              UART2_SendHex(Volume_plus,sizeof(Volume_plus));
*** WARNING C198 IN LINE 209 OF ..\Hardware\Menu.c: sizeof returns zero
 210   4              Volume%=31;
 211   4            }
 212   3            else if((KeyNum==Key2_Single_Click||KeyNum==Key2_Long_Click)&&Busy_Music==1)
 213   3            {
 214   4              Volume--;
 215   4              UART2_SendHex(Volume_down,sizeof(Volume_down));
*** WARNING C198 IN LINE 215 OF ..\Hardware\Menu.c: sizeof returns zero
 216   4              
 217   4              if(Volume<0)
 218   4              Volume=30;
 219   4            }
 220   3            UART2_SendHex(Volume_play1, sizeof(Volume_play1));
*** WARNING C198 IN LINE 220 OF ..\Hardware\Menu.c: sizeof returns zero
 221   3            OLED_ShowNum(80,0,Volume,2,16,0);
 222   3          }
 223   2          else
 224   2          {
 225   3            Menu_Lock(KeyNum);
 226   3          }
 227   2            
 228   2          if(KeyNum==Key3_Double_Click)
 229   2          {//返回上一级
 230   3            Menu_state-=MenuSet_state;
 231   3            if(TimeSetting==1){TimeSetting=0;}
C51 COMPILER V9.60.7.0   MENU                                                              11/29/2024 17:30:57 PAGE 5   

 232   3            if(bLock_Set==1){bLock_Set=0;cLockSelect=0;}
 233   3            OLED_Clear();
 234   3            OLED_Background24();
 235   3          }
 236   2        }
 237   1      }
 238          
 239          void Secondary_Menu(u8 mode,u8 KeyNum)
 240          {
 241   1        switch(mode)
 242   1        {
 243   2          case 20:OLED_Background20();break;//进入秒表
 244   2          case 22:OLED_Background22();break;//进入时控
 245   2          case 24:OLED_Background24();break;//进入设置
 246   2        }
 247   1        if(KeyNum==Key3_Double_Click)
 248   1        {//返回上一级
 249   2          Menu_state-=10;OLED_Clear();OLED_Background1(Menu_state);
 250   2          if(Menu_state==12){Countdown_select=0;}
 251   2        }
 252   1      }
 253          
 254          void Menu_Lock(u8 KeyNum)
 255          {
 256   1        //显示按键
 257   1        if(KeyNum == Key1_Single_Click) {OLED_ShowString(0,6,"K1S",8,1);}
 258   1        if(KeyNum == Key1_Double_Click) {OLED_ShowString(0,6,"K1D",8,1);}
 259   1        if(KeyNum == Key1_Long_Click)   {OLED_ShowString(0,6,"K1L",8,1);}
 260   1        
 261   1        if(KeyNum == Key2_Single_Click) {OLED_ShowString(0,6,"K2S",8,1);}
 262   1        if(KeyNum == Key2_Double_Click) {OLED_ShowString(0,6,"K2D",8,1);}
 263   1        if(KeyNum == Key2_Long_Click)   {OLED_ShowString(0,6,"K2L",8,1);}
 264   1                                      
 265   1        if(KeyNum == Key3_Single_Click) {OLED_ShowString(0,6,"K3S",8,1);}
 266   1        if(KeyNum == Key3_Double_Click) {OLED_ShowString(0,6,"K3D",8,1);}
 267   1        if(KeyNum == Key3_Long_Click)   {OLED_ShowString(0,6,"K3L",8,1);}
 268   1        
 269   1        if(Menu_state==0)
 270   1        {
 271   2          Code_Input(KeyNum);
 272   2          if(KeyNum==Key3_Long_Click)
 273   2          {
 274   3            if(nLockNum==nLockNum_Set)
 275   3            {
 276   4              bLock = 1;
 277   4              cLockSelect=0;
 278   4              Menu_state = 10;
 279   4              nLockNum=0;
 280   4              OLED_Clear();   
 281   4              OLED_Background1(Menu_state);
 282   4            }
 283   3          }
 284   2        }
 285   1        if(Menu_state==34)
 286   1        {
 287   2          bLock_Set=1;
 288   2          Code_Input(KeyNum);
 289   2          if(KeyNum==Key3_Long_Click)
 290   2          {
 291   3            cLockSelect=0;
 292   3            OLED_Clear();
 293   3            Menu_state-=10;
C51 COMPILER V9.60.7.0   MENU                                                              11/29/2024 17:30:57 PAGE 6   

 294   3            
 295   3            nLockNum_Set=nLockNum;
 296   3            IAP_EraseSector(0);//扇区擦除，一个扇区512字节
 297   3            EEPROM_site=5;
 298   3            IAP_ProgramByte(0,nLockNum_Set/256);
 299   3            IAP_ProgramByte(1,nLockNum_Set);
 300   3            IAP_ProgramByte(2,Countdown_Hour);
 301   3            IAP_ProgramByte(3,Countdown_Min);
 302   3            IAP_ProgramByte(4,Countdown_Sec);
 303   3            
 304   3          }
 305   2        } 
 306   1      }
 307          
 308          void Code_Input(u8 KeyNum)
 309          {
 310   1        char cCode[4];
 311   1        
 312   1        cCode[0]=nLockNum/1000;
 313   1        cCode[1]=nLockNum/100%10; 
 314   1        cCode[2]=nLockNum/10%10;  
 315   1        cCode[3]=nLockNum%10; 
 316   1        
 317   1        if(KeyNum==Key1_Single_Click||KeyNum==Key1_Long_Click)
 318   1        {
 319   2          if(++cCode[cLockSelect]>9){cCode[cLockSelect]=0;}
 320   2          nLockNum=cCode[0]*1000+cCode[1]*100+cCode[2]*10+cCode[3];
 321   2        }
 322   1        if(KeyNum==Key2_Single_Click||KeyNum==Key2_Long_Click)
 323   1        {
 324   2          if(--cCode[cLockSelect]<0){cCode[cLockSelect]=9;}
 325   2          nLockNum=cCode[0]*1000+cCode[1]*100+cCode[2]*10+cCode[3];
 326   2        }
 327   1        
 328   1        if(KeyNum==Key3_Single_Click)
 329   1        {
 330   2          if(++cLockSelect>3){cLockSelect=0;}
 331   2        }
 332   1        OLED_Lock();
 333   1      } 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2984    ----
   CONSTANT SIZE    =     38    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  3 WARNING(S),  0 ERROR(S)
